<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>De (decompress.De)</title><link rel="stylesheet" href="../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 1.5.2"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> – <a href="../index.html">decompress</a> &#x00BB; De</nav><h1>Module <code>De</code></h1><h2 id="rfc1951/deflate-codec."><a href="#rfc1951/deflate-codec." class="anchor"></a>RFC1951/DEFLATE codec.</h2><p>RFC1951/DEFLATE is a IETF standard. Module provides non-blocking streaming codec to <a href="#decode">decode</a> and <a href="#encode">encode</a> DEFLATE encoding. It can efficiently work payload by payload without blocking IO.</p><p>Module provides <a href="#compression">LZ77 compression</a> algorithm but let the client to define his algorithm as long as he uses shared queue provided in this module.</p><nav class="toc"><ul><li><a href="#prelude.">Prelude.</a></li><li><a href="#window.">Window.</a></li><li><a href="#decode">DEFLATE Decoder.</a></li><li><a href="#queue.">Queue.</a></li><li><a href="#frequencies.">Frequencies.</a></li><li><a href="#encode">DEFLATE Encoder.</a></li><li><a href="#compression">LZ77 compression algorithm.</a></li><li><a href="#higher-api.">Higher API.</a></li></ul></nav></header><section><header><h3 id="prelude."><a href="#prelude." class="anchor"></a>Prelude.</h3><p><code>de</code> wants to be self-contained. By this constraint, it provides convenience values to be used by others (like <code>zl</code>). The client should not use these functions even if they are available. Others libraries like <code>Bigstringaf</code> serve the same purpose of a much better way.</p></header><dl><dt class="spec module" id="module-Bigarray"><a href="#module-Bigarray" class="anchor"></a><code><span class="keyword">module</span> Bigarray = Bigarray_compat</code></dt><dd><p>MirageOS compatibility.</p></dd></dl><dl><dt class="spec type" id="type-bigstring"><a href="#type-bigstring" class="anchor"></a><code><span class="keyword">type</span> bigstring</code><code> = <span><span>(char, <a href="index.html#module-Bigarray">Bigarray</a>.int8_unsigned_elt, <a href="index.html#module-Bigarray">Bigarray</a>.c_layout)</span> <a href="index.html#module-Bigarray">Bigarray</a>.Array1.t</span></code></dt><dd><p>The type for <code>bigstring</code>.</p></dd></dl><dl><dt class="spec type" id="type-optint"><a href="#type-optint" class="anchor"></a><code><span class="keyword">type</span> optint</code><code> = Optint.t</code></dt><dd><p>Type type for optimal integer.</p></dd></dl><dl><dt class="spec value" id="val-bigstring_empty"><a href="#val-bigstring_empty" class="anchor"></a><code><span class="keyword">val</span> bigstring_empty : <a href="index.html#type-bigstring">bigstring</a></code></dt><dd><p>An empty <a href="index.html#type-bigstring"><code>bigstring</code></a>.</p></dd></dl><dl><dt class="spec value" id="val-bigstring_create"><a href="#val-bigstring_create" class="anchor"></a><code><span class="keyword">val</span> bigstring_create : int <span>&#45;&gt;</span> <a href="index.html#type-bigstring">bigstring</a></code></dt><dd><p><code>bigstring_create len</code> returns a uninitialized bigstring of length <code>len</code>.</p></dd></dl><dl><dt class="spec value" id="val-bigstring_length"><a href="#val-bigstring_length" class="anchor"></a><code><span class="keyword">val</span> bigstring_length : <a href="index.html#type-bigstring">bigstring</a> <span>&#45;&gt;</span> int</code></dt><dd><p><code>bigstring_length t</code> is the length of the bigstring <code>t</code>, in bytes.</p></dd></dl><dl><dt class="spec value" id="val-io_buffer_size"><a href="#val-io_buffer_size" class="anchor"></a><code><span class="keyword">val</span> io_buffer_size : int</code></dt></dl></section><section><header><h3 id="window."><a href="#window." class="anchor"></a>Window.</h3></header><dl><dt class="spec type" id="type-window"><a href="#type-window" class="anchor"></a><code><span class="keyword">type</span> window</code></dt><dd><p>The type for windows.</p></dd></dl><dl><dt class="spec value" id="val-make_window"><a href="#val-make_window" class="anchor"></a><code><span class="keyword">val</span> make_window : <span>bits:int</span> <span>&#45;&gt;</span> <a href="index.html#type-window">window</a></code></dt><dd><p><code>make_window</code> allocates a new buffer which represents a <i>window</i>. It used by decoder and LZ77 compressor to keep tracking older inputs and:</p><ul><li>process a copy from a distance by the decoder.</li><li>generate a copy from the compression algorithm.</li></ul></dd></dl><dl><dt class="spec value" id="val-window_bits"><a href="#val-window_bits" class="anchor"></a><code><span class="keyword">val</span> window_bits : <a href="index.html#type-window">window</a> <span>&#45;&gt;</span> int</code></dt></dl></section><section><header><h3 id="decode"><a href="#decode" class="anchor"></a>DEFLATE Decoder.</h3><p>Decoder of RFC1951 DEFLATE codec. <code>de</code> provides a <a href="Inf/index.html#type-decoder"><code>Inf.decoder</code></a> to decode DEFLATE input and inflate it.</p></header><div class="spec module" id="module-Inf"><a href="#module-Inf" class="anchor"></a><code><span class="keyword">module</span> <a href="Inf/index.html">Inf</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div></section><section><header><h3 id="queue."><a href="#queue." class="anchor"></a>Queue.</h3><p>DEFLATE encoder needs a compressed input which can be transmited by a shared queue filled by compression algorithm. <code>B</code> is used between <code>N</code> and a compression algorithm like <code>L</code>. It provides a small representation of commands (see <a href="Queue/index.html#type-cmd"><code>Queue.cmd</code></a>) emitted by compression algorithm.</p><p><code>N</code> encoder interprets <a href="Queue/index.html#type-cmd"><code>Queue.cmd</code></a> as fast as it can. Shared queue can be a bottleneck about the whole compression process. Indeed, it limits encoder on how many bytes it can produce. We recommend to make a queue as large as output buffer.</p></header><div class="spec module" id="module-Queue"><a href="#module-Queue" class="anchor"></a><code><span class="keyword">module</span> <a href="Queue/index.html">Queue</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div></section><section><header><h3 id="frequencies."><a href="#frequencies." class="anchor"></a>Frequencies.</h3><p>DYNAMIC DEFLATE block needs frequencies of code emitted by compression algorithm. <a href="index.html#type-literals"><code>literals</code></a> and <a href="index.html#type-distances"><code>distances</code></a> exist to keep frequencies while compression process.</p></header><dl><dt class="spec type" id="type-literals"><a href="#type-literals" class="anchor"></a><code><span class="keyword">type</span> literals</code><code> = <span class="keyword">private</span> <span>int array</span></code></dt><dd><p>The type of frequencies of literals (including lengths).</p></dd></dl><dl><dt class="spec type" id="type-distances"><a href="#type-distances" class="anchor"></a><code><span class="keyword">type</span> distances</code><code> = <span class="keyword">private</span> <span>int array</span></code></dt><dd><p>The type of frequencies of distances.</p></dd></dl><dl><dt class="spec value" id="val-make_literals"><a href="#val-make_literals" class="anchor"></a><code><span class="keyword">val</span> make_literals : unit <span>&#45;&gt;</span> <a href="index.html#type-literals">literals</a></code></dt><dd><p><code>make_literals</code> allocates a new <a href="index.html#type-literals"><code>literals</code></a> where frequencies of symbols (expect <i>End Of Block</i>) are set to 0.</p></dd></dl><dl><dt class="spec value" id="val-make_distances"><a href="#val-make_distances" class="anchor"></a><code><span class="keyword">val</span> make_distances : unit <span>&#45;&gt;</span> <a href="index.html#type-distances">distances</a></code></dt><dd><p><code>make_distances</code> allocates a new <a href="index.html#type-distances"><code>distances</code></a> where frequencies of <i>distance</i> symboles are set to 0.</p></dd></dl><dl><dt class="spec value" id="val-succ_literal"><a href="#val-succ_literal" class="anchor"></a><code><span class="keyword">val</span> succ_literal : <a href="index.html#type-literals">literals</a> <span>&#45;&gt;</span> char <span>&#45;&gt;</span> unit</code></dt><dd><p><code>succ_literals literals chr</code> increases frequency of <code>chr</code>.</p></dd></dl><dl><dt class="spec value" id="val-succ_length"><a href="#val-succ_length" class="anchor"></a><code><span class="keyword">val</span> succ_length : <a href="index.html#type-literals">literals</a> <span>&#45;&gt;</span> int <span>&#45;&gt;</span> unit</code></dt><dd><p><code>succ_length literals l</code> increases frequency of <code>l</code> code. <code>l</code> must be upper than 2 and lower than 259 according DEFLATE codec. Otherwise, it raises an <code>Invalid_argument</code>.</p></dd></dl><dl><dt class="spec value" id="val-succ_distance"><a href="#val-succ_distance" class="anchor"></a><code><span class="keyword">val</span> succ_distance : <a href="index.html#type-distances">distances</a> <span>&#45;&gt;</span> int <span>&#45;&gt;</span> unit</code></dt><dd><p><code>succ_distance distance d</code> increases frequency of <code>d</code> code. <code>d</code> must be upper than 0 and lower than 32769 according DEFLATE codec. Otherwise, it raises an <code>Invalid_argument</code>.</p></dd></dl></section><section><header><h3 id="encode"><a href="#encode" class="anchor"></a>DEFLATE Encoder.</h3></header><div class="spec module" id="module-Def"><a href="#module-Def" class="anchor"></a><code><span class="keyword">module</span> <a href="Def/index.html">Def</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div></section><section><header><h3 id="compression"><a href="#compression" class="anchor"></a>LZ77 compression algorithm.</h3><p>Distribution provides LZ77 compression algorithm which can be used with <code>N</code>. However, the client must know others algorithms exist. This algorithm is used by <code>zz</code> to implement ZLIB layer.</p></header><div class="spec module" id="module-Lz77"><a href="#module-Lz77" class="anchor"></a><code><span class="keyword">module</span> <a href="Lz77/index.html">Lz77</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div></section><section><header><h3 id="higher-api."><a href="#higher-api." class="anchor"></a>Higher API.</h3><p><code>de</code> provides useful but complex API. This sub-module provides an easier way to compress/uncompress DEFLATE codec. Even if the client still can give some details, we recommend to use <a href="Inf/index.html"><code>Inf</code></a> and <a href="Def/index.html"><code>Def</code></a> if you want a precise control about memory consumption.</p></header><div class="spec module" id="module-Higher"><a href="#module-Higher" class="anchor"></a><code><span class="keyword">module</span> <a href="Higher/index.html">Higher</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><aside><p>/ *</p></aside><dl><dt class="spec value" id="val-unsafe_set_cursor"><a href="#val-unsafe_set_cursor" class="anchor"></a><code><span class="keyword">val</span> unsafe_set_cursor : <a href="Inf/index.html#type-decoder">Inf.decoder</a> <span>&#45;&gt;</span> int <span>&#45;&gt;</span> unit</code></dt></dl><div class="spec module" id="module-Lookup"><a href="#module-Lookup" class="anchor"></a><code><span class="keyword">module</span> <a href="Lookup/index.html">Lookup</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><div class="spec module" id="module-T"><a href="#module-T" class="anchor"></a><code><span class="keyword">module</span> <a href="T/index.html">T</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div></section></div></body></html>