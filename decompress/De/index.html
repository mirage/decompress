<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>De (decompress.De)</title><link rel="stylesheet" href="../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.1.1"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../index.html">decompress</a> &#x00BB; De</nav><header class="odoc-preamble"><h1>Module <code><span>De</span></code></h1></header><nav class="odoc-toc"><ul><li><a href="#rfc1951/deflate-codec.">RFC1951/DEFLATE codec.</a></li><li><a href="#lz77-compression-and-huffman-compression.">Lz77 compression and huffman compression.</a><ul><li><a href="#prelude.">Prelude.</a></li><li><a href="#window.">Window.</a></li><li><a href="#decode">DEFLATE Decoder.</a></li><li><a href="#queue.">Queue.</a></li><li><a href="#frequencies.">Frequencies.</a></li><li><a href="#encode">DEFLATE Encoder.</a></li><li><a href="#compression">LZ77 compression algorithm.</a></li><li><a href="#higher-api.">Higher API.</a></li></ul></li></ul></nav><div class="odoc-content"><h2 id="rfc1951/deflate-codec."><a href="#rfc1951/deflate-codec." class="anchor"></a>RFC1951/DEFLATE codec.</h2><p>RFC1951/DEFLATE is a IETF standard. Module provides non-blocking streaming codec to <a href="#decode">decode</a> and <a href="#encode">encode</a> DEFLATE encoding. It can efficiently work payload by payload without blocking IO.</p><p>Module provides <a href="#compression">LZ77 compression</a> algorithm but lets the client to define his algorithm as long as he/she uses shared queue provided in this module.</p><h2 id="lz77-compression-and-huffman-compression."><a href="#lz77-compression-and-huffman-compression." class="anchor"></a>Lz77 compression and huffman compression.</h2><p><code>Lz77</code> does a compression such as it searches a repeated <i>pattern</i> and emits a <code>Copy</code> code (see <a href="Queue/index.html#type-cmd"><code>Queue.cmd</code></a>) which tells us to copy a previous pattern. For instance, this is an equivalence between a list of <a href="Queue/index.html#type-cmd"><code>Queue.cmd</code></a>s and a <code>string</code>.</p><pre><code>let cmds = [ `Literal 'a'; `Copy (1, 3) ]
let results = &quot;aaaa&quot;</code></pre><p>The goal of <code>Lz77</code> is to produce such list from a <code>string</code> to help then a format such as <code>DEFLATE</code> to compress inputs.</p><p><code>Def</code> does an huffman compression. From a list of <a href="Queue/index.html#type-cmd"><code>Queue.cmd</code></a>, it can calculate frequencies (see <a href="#type-literals"><code>literals</code></a> and <a href="#type-distances"><code>distances</code></a>) and generate a smaller representation of the given <i>alphabet</i>. Such compression is available <i>via</i> the <code>Def</code>.Fixed or the <code>Def</code>.Dynamic block. The <code>Def</code>.Flat block does a copy of any literals into the output.</p><p><b>NOTE</b>: It's illegal to emit a <code>`Copy</code> <a href="Queue/index.html#type-cmd"><code>Queue.cmd</code></a> and try to serialize it with a <code>Def</code>.Flat block. <a href="Queue/index.html#val-eob"><code>Queue.eob</code></a> is <b>required</b> for <code>Def</code>.Fixed and <code>Def</code>.Dynamic (to delimit the end of the block) and ignored by the <code>Def</code>.Flat block.</p><h3 id="prelude."><a href="#prelude." class="anchor"></a>Prelude.</h3><p><code>de</code> wants to be self-contained. By this constraint, it provides convenience values to be used by others (like <code>zl</code>). The client should not use these functions even if they are available. Others libraries like <code>Bigstringaf</code> serve the same purpose of a much better way.</p><div class="odoc-spec"><div class="spec type" id="type-bigstring" class="anchored"><a href="#type-bigstring" class="anchor"></a><code><span><span class="keyword">type</span> bigstring</span><span> =
  <span><span>( char, <span class="xref-unresolved">Stdlib</span>.Bigarray.int8_unsigned_elt, <span class="xref-unresolved">Stdlib</span>.Bigarray.c_layout )</span>
    <span class="xref-unresolved">Stdlib</span>.Bigarray.Array1.t</span></span></code></div><div class="spec-doc"><p>The type for <code>bigstring</code>.</p></div></div><div class="odoc-spec"><div class="spec type" id="type-optint" class="anchored"><a href="#type-optint" class="anchor"></a><code><span><span class="keyword">type</span> optint</span><span> = <span class="xref-unresolved">Optint</span>.t</span></code></div><div class="spec-doc"><p>Type type for optimal integer.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-bigstring_empty" class="anchored"><a href="#val-bigstring_empty" class="anchor"></a><code><span><span class="keyword">val</span> bigstring_empty : <a href="#type-bigstring">bigstring</a></span></code></div><div class="spec-doc"><p>An empty <a href="#type-bigstring"><code>bigstring</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-bigstring_create" class="anchored"><a href="#val-bigstring_create" class="anchor"></a><code><span><span class="keyword">val</span> bigstring_create : <span>int <span class="arrow">&#45;&gt;</span></span> <a href="#type-bigstring">bigstring</a></span></code></div><div class="spec-doc"><p><code>bigstring_create len</code> returns a uninitialized bigstring of length <code>len</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-bigstring_length" class="anchored"><a href="#val-bigstring_length" class="anchor"></a><code><span><span class="keyword">val</span> bigstring_length : <span><a href="#type-bigstring">bigstring</a> <span class="arrow">&#45;&gt;</span></span> int</span></code></div><div class="spec-doc"><p><code>bigstring_length t</code> is the length of the bigstring <code>t</code>, in bytes.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-io_buffer_size" class="anchored"><a href="#val-io_buffer_size" class="anchor"></a><code><span><span class="keyword">val</span> io_buffer_size : int</span></code></div></div><h3 id="window."><a href="#window." class="anchor"></a>Window.</h3><div class="odoc-spec"><div class="spec type" id="type-window" class="anchored"><a href="#type-window" class="anchor"></a><code><span><span class="keyword">type</span> window</span></code></div><div class="spec-doc"><p>The type for windows.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-make_window" class="anchored"><a href="#val-make_window" class="anchor"></a><code><span><span class="keyword">val</span> make_window : <span>bits:int <span class="arrow">&#45;&gt;</span></span> <a href="#type-window">window</a></span></code></div><div class="spec-doc"><p><code>make_window</code> allocates a new buffer which represents a <i>window</i>. It used by decoder and LZ77 compressor to keep tracking older inputs and:</p><ul><li>process a copy from a distance by the decoder.</li><li>generate a copy from the compression algorithm.</li></ul></div></div><div class="odoc-spec"><div class="spec value" id="val-window_bits" class="anchored"><a href="#val-window_bits" class="anchor"></a><code><span><span class="keyword">val</span> window_bits : <span><a href="#type-window">window</a> <span class="arrow">&#45;&gt;</span></span> int</span></code></div></div><h3 id="decode"><a href="#decode" class="anchor"></a>DEFLATE Decoder.</h3><p>Decoder of RFC1951 DEFLATE codec. <code>de</code> provides a <a href="Inf/index.html#type-decoder"><code>Inf.decoder</code></a> to decode DEFLATE input and inflate it.</p><div class="odoc-spec"><div class="spec module" id="module-Inf" class="anchored"><a href="#module-Inf" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Inf/index.html">Inf</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><h3 id="queue."><a href="#queue." class="anchor"></a>Queue.</h3><p>DEFLATE encoder needs a compressed input which can be transmited by a shared queue filled by compression algorithm. <code>B</code> is used between <code>N</code> and a compression algorithm like <code>L</code>. It provides a small representation of commands (see <a href="Queue/index.html#type-cmd"><code>Queue.cmd</code></a>) emitted by compression algorithm.</p><p><code>N</code> encoder interprets <a href="Queue/index.html#type-cmd"><code>Queue.cmd</code></a> as fast as it can. Shared queue can be a bottleneck about the whole compression process. Indeed, it limits encoder on how many bytes it can produce. We recommend to make a queue as large as output buffer.</p><div class="odoc-spec"><div class="spec module" id="module-Queue" class="anchored"><a href="#module-Queue" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Queue/index.html">Queue</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><h3 id="frequencies."><a href="#frequencies." class="anchor"></a>Frequencies.</h3><p>DYNAMIC DEFLATE block needs frequencies of code emitted by compression algorithm. <a href="#type-literals"><code>literals</code></a> and <a href="#type-distances"><code>distances</code></a> exist to keep frequencies while compression process.</p><div class="odoc-spec"><div class="spec type" id="type-literals" class="anchored"><a href="#type-literals" class="anchor"></a><code><span><span class="keyword">type</span> literals</span><span> = <span class="keyword">private</span> <span>int array</span></span></code></div><div class="spec-doc"><p>The type of frequencies of literals (including lengths).</p></div></div><div class="odoc-spec"><div class="spec type" id="type-distances" class="anchored"><a href="#type-distances" class="anchor"></a><code><span><span class="keyword">type</span> distances</span><span> = <span class="keyword">private</span> <span>int array</span></span></code></div><div class="spec-doc"><p>The type of frequencies of distances.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-make_literals" class="anchored"><a href="#val-make_literals" class="anchor"></a><code><span><span class="keyword">val</span> make_literals : <span>unit <span class="arrow">&#45;&gt;</span></span> <a href="#type-literals">literals</a></span></code></div><div class="spec-doc"><p><code>make_literals</code> allocates a new <a href="#type-literals"><code>literals</code></a> where frequencies of symbols (expect <i>End Of Block</i>) are set to 0.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-make_distances" class="anchored"><a href="#val-make_distances" class="anchor"></a><code><span><span class="keyword">val</span> make_distances : <span>unit <span class="arrow">&#45;&gt;</span></span> <a href="#type-distances">distances</a></span></code></div><div class="spec-doc"><p><code>make_distances</code> allocates a new <a href="#type-distances"><code>distances</code></a> where frequencies of <i>distance</i> symboles are set to 0.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-succ_literal" class="anchored"><a href="#val-succ_literal" class="anchor"></a><code><span><span class="keyword">val</span> succ_literal : <span><a href="#type-literals">literals</a> <span class="arrow">&#45;&gt;</span></span> <span>char <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>succ_literals literals chr</code> increases frequency of <code>chr</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-succ_length" class="anchored"><a href="#val-succ_length" class="anchor"></a><code><span><span class="keyword">val</span> succ_length : <span><a href="#type-literals">literals</a> <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>succ_length literals l</code> increases frequency of <code>l</code> code. <code>l</code> must be upper than 2 and lower than 259 according DEFLATE codec. Otherwise, it raises an <code>Invalid_argument</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-succ_distance" class="anchored"><a href="#val-succ_distance" class="anchor"></a><code><span><span class="keyword">val</span> succ_distance : <span><a href="#type-distances">distances</a> <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>succ_distance distance d</code> increases frequency of <code>d</code> code. <code>d</code> must be upper than 0 and lower than 32769 according DEFLATE codec. Otherwise, it raises an <code>Invalid_argument</code>.</p></div></div><h3 id="encode"><a href="#encode" class="anchor"></a>DEFLATE Encoder.</h3><div class="odoc-spec"><div class="spec module" id="module-Def" class="anchored"><a href="#module-Def" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Def/index.html">Def</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><h3 id="compression"><a href="#compression" class="anchor"></a>LZ77 compression algorithm.</h3><p>Distribution provides LZ77 compression algorithm which can be used with <code>N</code>. However, the client must know others algorithms exist. This algorithm is used by <code>zz</code> to implement ZLIB layer.</p><div class="odoc-spec"><div class="spec module" id="module-Lz77" class="anchored"><a href="#module-Lz77" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Lz77/index.html">Lz77</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><h3 id="higher-api."><a href="#higher-api." class="anchor"></a>Higher API.</h3><p><code>de</code> provides useful but complex API. This sub-module provides an easier way to compress/uncompress DEFLATE codec. Even if the client still can give some details, we recommend to use <a href="Inf/index.html"><code>Inf</code></a> and <a href="Def/index.html"><code>Def</code></a> if you want a precise control about memory consumption.</p><div class="odoc-spec"><div class="spec module" id="module-Higher" class="anchored"><a href="#module-Higher" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Higher/index.html">Higher</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><p>/ *</p><div class="odoc-spec"><div class="spec value" id="val-unsafe_set_cursor" class="anchored"><a href="#val-unsafe_set_cursor" class="anchor"></a><code><span><span class="keyword">val</span> unsafe_set_cursor : <span><a href="Inf/index.html#type-decoder">Inf.decoder</a> <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><div class="odoc-spec"><div class="spec module" id="module-Lookup" class="anchored"><a href="#module-Lookup" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Lookup/index.html">Lookup</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec module" id="module-T" class="anchored"><a href="#module-T" class="anchor"></a><code><span><span class="keyword">module</span> <a href="T/index.html">T</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div></div></body></html>